#Annotations router kube
cert-manager.io/cluster-issuer  	: letsencrypt-prod
kubernetes.io/ingress.class		: nginx
kubernetes.io/ingress.provider 		: nginx

---
# docker build image 
#docker build -t image_name:tag .
#docker run image

#nguyensang/business-management-api

# run redis ubuntu
# sudo service redis-server start

# reset database redis
# redis-cli FLUSHDB


DELETE FROM business
WHERE id IN (
    SELECT id
    FROM (
        SELECT id, name, phone, address, ROW_NUMBER() OVER (PARTITION BY name, phone, address ORDER BY id) AS rnum
        FROM business
    ) AS t
    WHERE t.rnum > 1
);

SELECT phone, name, address, COUNT(*) AS duplicate_count
FROM business
GROUP BY phone, name, address
HAVING COUNT(*) > 1;


DELETE FROM business
WHERE "scratchLink" LIKE '%https://www.yellowpages.com%';


UPDATE business
SET source = 'yelp'
WHERE "scratchLink" LIKE '%https://www.yelp.com%';

SELECT COUNT(*) AS total_records
FROM business
where keyword = 'Restaurants'

UPDATE business
SET categories = array_cat(categories, ARRAY['Restaurants'])
WHERE keyword = 'Restaurants'
AND NOT 'Restaurants' = ANY(categories);


UPDATE business
SET categories = array_cat(categories, ARRAY['Restaurants'])
WHERE ARRAY['Vietnamese Restaurants']::varchar[] <@ categories
AND NOT 'Restaurants' = ANY(categories);